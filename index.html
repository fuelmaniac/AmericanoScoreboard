<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🃏 Americano Oyun Takip Sistemi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .hidden { display: none !important; }
        .fade-in { 
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        /* Language Toggle Styles */
        .language-toggle {
            position: relative;
            display: inline-flex;
            align-items: center;
            background: #f3f4f6;
            border-radius: 12px;
            padding: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .language-toggle.dark {
            background: #374151;
        }
        
        .language-option {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }
        
        .language-option.active {
            background: #3b82f6;
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .language-option.inactive {
            color: #6b7280;
        }
        
        .language-option.inactive.dark {
            color: #9ca3af;
        }
        
        /* Mobil için özel input styling */
        @media (max-width: 768px) {
            /* Tüm grid'leri mobilde tek kolona zorla */
            .grid {
                grid-template-columns: 1fr !important;
            }
            
            input[type="text"], input[type="number"], select {
                font-size: 18px !important;
                padding: 16px !important;
                min-height: 60px !important;
                line-height: 1.2 !important;
                width: 100% !important;
            }
            
            input::placeholder {
                font-size: 16px !important;
            }
            
            /* Mobil Safari için zoom engelleyici */
            input[type="text"]:focus,
            input[type="number"]:focus,
            select:focus {
                font-size: 18px !important;
                transform: scale(1);
            }
            
            /* Button'ları da büyült */
            button {
                min-height: 48px !important;
                font-size: 14px !important;
                padding: 12px 16px !important;
            }
            
            /* Player cards'ını daha geniş yap */
            .grid > div {
                width: 100% !important;
                margin-bottom: 16px;
            }
        }
    </style>
</head>
<body>
    <div id="app" class="max-w-7xl mx-auto p-6 min-h-screen transition-colors bg-gradient-to-br from-purple-50 to-blue-100">
        
        <!-- Setup Screen -->
        <div id="setupScreen" class="max-w-4xl mx-auto">
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <div class="text-center mb-8">
                    <div class="flex items-center justify-center gap-3 mb-4">
                        <div class="w-8 h-8 text-purple-600 flex items-center justify-center">⚙️</div>
                        <h1 id="setupTitle" class="text-3xl font-bold text-gray-800">🃏 Americano Oyun Kurulumu</h1>
                        <!-- Language Toggle -->
                        <div class="ml-4">
                            <div id="languageToggle" class="language-toggle" onclick="toggleLanguage()">
                                <div id="langTr" class="language-option active">TR</div>
                                <div id="langEn" class="language-option inactive">EN</div>
                            </div>
                        </div>
                    </div>
                    <p id="setupSubtitle" class="text-gray-600">Oyuncu sayısı ve isimlerini ayarlayın</p>
                </div>

                <!-- Player Count Section -->
                <div class="rounded-xl p-6 mb-6 bg-blue-50">
                    <h3 id="playerCountTitle" class="font-bold text-lg mb-4 text-center text-gray-800">Oyuncu Sayısı</h3>
                    <div class="flex items-center justify-center gap-4">
                        <button id="removePlayerBtn" class="p-3 rounded-lg font-bold transition-all bg-gray-300 text-gray-500 cursor-not-allowed">
                            ➖
                        </button>
                        <div id="playerCountDisplay" class="text-4xl font-bold text-purple-600 rounded-lg py-3 px-6 shadow-inner min-w-[80px] text-center bg-white">
                            3
                        </div>
                        <button id="addPlayerBtn" class="p-3 rounded-lg font-bold transition-all bg-green-500 text-white hover:bg-green-600">
                            ➕
                        </button>
                    </div>
                    <p id="playerCountDesc" class="text-center mt-2 text-gray-600">3-5 oyuncu</p>
                </div>

                <!-- Player Names Section -->
                <div class="rounded-xl p-6 mb-6 bg-yellow-50">
                    <h3 id="playerNamesTitle" class="font-bold text-lg mb-4 text-center text-gray-800">Oyuncu İsimleri</h3>
                    <div id="playerInputs" class="grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
                        <!-- Player inputs will be dynamically generated -->
                    </div>
                </div>

                <!-- Game Stake Section -->
                <div class="rounded-xl p-6 mb-6 bg-orange-50">
                    <h3 id="gameStakeTitle" class="font-bold text-lg mb-4 text-center text-gray-800">Bu Oyun Neye Oynanıyor?</h3>
                    <div class="mb-4">
                        <input type="text" id="gameStakeInput" class="w-full p-4 md:p-4 text-lg md:text-xl min-h-[60px] md:min-h-[50px] border border-gray-300 rounded-lg text-center font-medium"
                               placeholder="Örnek: Kahve ısmarlama, Yemek ısmarlama..." style="font-size: 18px !important; padding: 16px !important;" />
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                        <button onclick="setStake('coffee')" id="coffeeBtn" class="p-2 rounded-lg text-sm bg-white hover:bg-gray-50 text-black transition-colors">☕ Kahve</button>
                        <button onclick="setStake('food')" id="foodBtn" class="p-2 rounded-lg text-sm bg-white hover:bg-gray-50 text-black transition-colors">🍕 Yemek</button>
                        <button onclick="setStake('icecream')" id="icecreamBtn" class="p-2 rounded-lg text-sm bg-white hover:bg-gray-50 text-black transition-colors">🍦 Dondurma</button>
                        <button onclick="setStake('fun')" id="funBtn" class="p-2 rounded-lg text-sm bg-white hover:bg-gray-50 text-black transition-colors">🎉 Eğlence</button>
                        <button onclick="setStake('money')" id="moneyBtn" class="p-2 rounded-lg text-sm bg-white hover:bg-gray-50 text-black transition-colors">💰 Para</button>
                        <button onclick="setCustomStake()" id="customBtn" class="p-2 rounded-lg text-sm bg-blue-100 hover:bg-blue-200 text-blue-800 transition-colors">✏️ Özel</button>
                    </div>
                </div>

                <!-- Start Button -->
                <div class="text-center">
                    <button id="startGameBtn" class="px-8 py-4 rounded-lg font-bold text-white text-xl transition-all bg-gray-400 cursor-not-allowed">
                        🎯 Oyunu Başlat
                    </button>
                    <div id="startGameError" class="text-red-500 mt-2 text-sm hidden">Lütfen tüm oyuncu isimlerini doldurun</div>
                    <div id="gameStakeDisplay" class="mt-3 p-2 bg-orange-100 rounded-lg hidden">
                        <p class="text-orange-800 text-sm">🏆 <span id="thisGameLabel">Bu oyun</span>: <strong id="gameStakeText"></strong></p>
                    </div>
                </div>

                <!-- Rules Section -->
                <div class="bg-green-50 rounded-xl p-6 mt-6">
                    <h3 id="gameRulesTitle" class="font-bold text-lg text-gray-800 mb-3">Oyun Kuralları:</h3>
                    <ul id="gameRulesList" class="space-y-2 text-gray-700">
                        <li>• <strong>3, 4 veya 5 oyuncuyla</strong> oynanır</li>
                        <li>• <strong>13 farklı ceza</strong> türü vardır</li>
                        <li>• <strong>"Elden" cezası</strong> mecburen son elde (13. el) oynanır</li>
                        <li>• <strong>Cezayı söyleyen VE bitiren</strong> aynı kişiyse +50 puan</li>
                        <li>• <strong>Cezayı söyleyen başarısız:</strong> Görevini yapamadan (açamadan) başkası bitirirse x2 ceza puanı alır</li>
                        <li>• <strong>Son elde (Elden) bonus yok:</strong> Cezayı söyleyip bitiren +50 alamaz</li>
                        <li>• <strong>İşler kağıt atan</strong> oyuncu -50 ceza puanı alır</li>
                        <li>• <strong>Joker ile bitiren</strong> herkese x2 ceza puanı yedirir</li>
                        <li>• <strong>Kazanma:</strong> En yüksek puan kazanır (eksi puanlarda en düşük eksi puan)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="hidden rounded-2xl shadow-xl p-8 bg-white">
            
            <!-- Game Header -->
            <div class="text-center mb-8">
                <div class="flex items-center justify-center gap-3 mb-4">
                    <div class="w-8 h-8 text-purple-600 flex items-center justify-center">▶️</div>
                    <h1 class="text-3xl font-bold text-gray-800">🃏 Americano</h1>
                    <button onclick="backToSetup()" class="ml-4 p-2 transition-all rounded-lg text-gray-500 hover:text-gray-700" title="Ayarlara dön">
                        ⚙️
                    </button>
                    <button id="darkModeBtn" onclick="toggleDarkMode()" class="ml-2 p-2 rounded-lg transition-all bg-gray-200 text-gray-700 hover:bg-gray-300" title="Gece modu">
                        🌙
                    </button>
                    <!-- Language Toggle in Game -->
                    <div class="ml-2">
                        <div id="languageToggleGame" class="language-toggle" onclick="toggleLanguage()">
                            <div id="langTrGame" class="language-option active">TR</div>
                            <div id="langEnGame" class="language-option inactive">EN</div>
                        </div>
                    </div>
                </div>
                <p id="playersDisplay" class="text-gray-600"></p>
                <div class="mt-2 text-lg font-semibold text-purple-600">
                    <span id="roundLabel">El</span> <span id="currentRoundDisplay">1</span> - <span id="remainingPenaltiesDisplay">13</span>/13 <span id="penaltiesLeftLabel">ceza kaldı</span>
                </div>
                <div id="gameStakeGameDisplay" class="mt-2 text-sm text-orange-600 hidden">
                    🏆 <span id="thisGameLabelGame">Bu oyun</span>: <strong id="gameStakeGameText"></strong>
                </div>
            </div>

            <!-- Leader Banner -->
            <div id="leaderBanner" class="p-4 rounded-xl mb-6 text-center bg-gradient-to-r from-purple-400 to-blue-500 text-white hidden">
                <div class="flex items-center justify-center gap-2">
                    <div class="w-6 h-6 flex items-center justify-center">🏆</div>
                    <span id="leaderText" class="font-bold text-lg"></span>
                </div>
            </div>

            <!-- Score Cards -->
            <div id="scoreCards" class="grid gap-4 mb-8 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
                <!-- Score cards will be dynamically generated -->
            </div>

            <!-- Round Input Section -->
            <div id="roundInputSection" class="bg-blue-50 rounded-xl p-6 mb-6">
                <h3 class="font-bold text-lg text-gray-800 mb-4"><span id="roundInputLabel">El</span> <span id="roundInputTitle">1</span> - <span id="scoreInputLabel">Puan Girişi</span></h3>
                
                <!-- Penalty and Caller Selection -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label id="penaltyPlayedLabel" class="block text-sm font-medium text-gray-700 mb-2">Bu Elde Oynanan Ceza:</label>
                        <select id="selectedPenalty" class="w-full p-4 md:p-3 text-lg md:text-lg min-h-[60px] md:min-h-[50px] border border-gray-300 rounded-lg font-medium" style="font-size: 18px !important; padding: 16px !important;">
                            <option value="" id="selectPenaltyOption">Ceza seçin...</option>
                        </select>
                    </div>
                    
                    <div>
                        <label id="penaltyCallerLabel" class="block text-sm font-medium text-gray-700 mb-2">Cezayı Söyleyen Oyuncu:</label>
                        <select id="penaltyCaller" class="w-full p-4 md:p-3 text-lg md:text-lg min-h-[60px] md:min-h-[50px] border border-gray-300 rounded-lg font-medium" style="font-size: 18px !important; padding: 16px !important;">
                            <option value="" id="selectPlayerOption">Oyuncu seçin...</option>
                        </select>
                    </div>
                </div>
                
                <!-- Player Input Cards -->
                <div id="playerInputCards" class="grid gap-4 mb-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
                    <!-- Player input cards will be dynamically generated -->
                </div>
                
                <!-- Calculate Button -->
                <div class="text-center">
                    <div id="warningMessages">
                        <!-- Warning messages will be dynamically added here -->
                    </div>
                    
                    <button id="calculateBtn" onclick="calculateRoundScore()" class="px-8 py-3 rounded-lg font-bold text-white transition-all bg-gray-400 cursor-not-allowed">
                        <span id="calculateBtnText">Tüm Alanları Doldurun</span>
                    </button>
                </div>
            </div>

            <!-- Game Over -->
            <div id="gameOverSection" class="bg-gradient-to-r from-green-400 to-blue-500 text-white p-6 rounded-xl mb-6 text-center hidden">
                <h2 id="gameOverTitle" class="text-2xl font-bold mb-2">🎉 OYUN BİTTİ! 🎉</h2>
                <p id="gameOverText" class="text-lg"></p>
            </div>

            <!-- Game History Table -->
            <div id="gameHistorySection" class="bg-gray-50 rounded-xl p-6 mb-6 hidden">
                <h3 class="font-bold text-lg text-gray-800 mb-4 flex items-center gap-2">
                    <div class="w-5 h-5 flex items-center justify-center">📊</div>
                    <span id="scoreTableTitle">Kümülatif Puan Tablosu</span>
                </h3>
                <div class="overflow-x-auto">
                    <table id="gameHistoryTable" class="w-full border-collapse bg-white rounded-lg overflow-hidden shadow">
                        <thead id="gameHistoryTableHead">
                            <!-- Table header will be dynamically generated -->
                        </thead>
                        <tbody id="gameHistoryTableBody">
                            <!-- Table body will be dynamically generated -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Remaining Penalties -->
            <div class="bg-yellow-50 rounded-xl p-6 mb-6">
                <h3 class="font-bold text-lg text-gray-800 mb-4 text-center">
                    <span id="remainingPenaltiesTitle">Kalan Cezalar</span> - <span id="remainingCount">13</span>/13
                </h3>
                <div id="remainingPenalties" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                    <!-- Remaining penalties will be dynamically generated -->
                </div>
            </div>

            <!-- Control Buttons -->
            <div class="flex gap-4 justify-center flex-wrap">
                <button onclick="showGameHistory()" id="historyBtn" class="font-bold py-3 px-6 rounded-lg transition-all bg-green-500 hover:bg-green-600 text-white">
                    📊 <span id="historyBtnText">Geçmiş Oyunlar</span>
                </button>
                <button onclick="showRules()" id="rulesBtn" class="font-bold py-3 px-6 rounded-lg transition-all bg-blue-500 hover:bg-blue-600 text-white">
                    📖 <span id="rulesBtnText">Kuralları Oku</span>
                </button>
                <button onclick="backToSetup()" id="settingsBtn" class="font-bold py-3 px-6 rounded-lg transition-all hover:scale-105 flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white">
                    <div class="w-5 h-5 flex items-center justify-center">⚙️</div>
                    <span id="settingsBtnText">Oyuncu Ayarları</span>
                </button>
                <button onclick="resetGame()" id="newGameBtn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition-all hover:scale-105 flex items-center gap-2">
                    <div class="w-5 h-5 flex items-center justify-center">🔄</div>
                    <span id="newGameBtnText">Yeni Oyun Başlat</span>
                </button>
            </div>
        </div>

        <!-- Game History Modal -->
        <div id="gameHistoryModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="max-w-4xl w-full max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl bg-white">
                <div class="sticky top-0 p-6 border-b bg-white border-gray-200">
                    <div class="flex justify-between items-center">
                        <h2 id="gameHistoryModalTitle" class="text-2xl font-bold text-gray-800">📊 Geçmiş Oyunlar</h2>
                        <button onclick="closeGameHistoryModal()" class="p-2 rounded-lg transition-all bg-gray-100 hover:bg-gray-200 text-gray-700">
                            ✕
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="gameHistoryList">
                        <!-- Game history will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Detail Modal -->
        <div id="gameDetailModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="max-w-4xl w-full max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl bg-white">
                <div class="sticky top-0 p-6 border-b bg-white border-gray-200">
                    <div class="flex justify-between items-center">
                        <h2 id="gameDetailModalTitle" class="text-2xl font-bold text-gray-800">🎮 Oyun Detayları</h2>
                        <button onclick="closeGameDetailModal()" class="p-2 rounded-lg transition-all bg-gray-100 hover:bg-gray-200 text-gray-700">
                            ✕
                        </button>
                    </div>
                </div>
                
                <div class="p-6">
                    <div id="gameDetailContent">
                        <!-- Game detail will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Translations object
        const translations = {
            tr: {
                // Setup Screen
                gameSetupTitle: '🃏 Americano Oyun Kurulumu',
                gameSetupSubtitle: 'Oyuncu sayısı ve isimlerini ayarlayın',
                playerCount: 'Oyuncu Sayısı',
                playerCountDesc: '3-5 oyuncu',
                playerNames: 'Oyuncu İsimleri',
                gameStakeTitle: 'Bu Oyun Neye Oynanıyor?',
                gameStakePlaceholder: 'Örnek: Kahve ısmarlama, Yemek ısmarlama...',
                startGame: '🎯 Oyunu Başlat',
                fillAllFields: 'Lütfen tüm oyuncu isimlerini doldurun',
                thisGame: 'Bu oyun',
                gameRules: 'Oyun Kuralları:',
                
                // Game Screen
                round: 'El',
                penaltiesLeft: 'ceza kaldı',
                leader: 'Lider',
                totalScore: 'toplam puan',
                scoreInput: 'Puan Girişi',
                penaltyPlayed: 'Bu Elde Oynanan Ceza:',
                selectPenalty: 'Ceza seçin...',
                penaltyCaller: 'Cezayı Söyleyen Oyuncu:',
                selectPlayer: 'Oyuncu seçin...',
                thisRoundPenalty: 'Bu Elde Ceza Sayısı',
                finishedRound: 'Eli Bitirdi',
                finishedWithJoker: 'Joker İle Bitirdi',
                threwUselessCard: 'İşler Kağıt Attı',
                failedToComplete: 'Görevini Açamadı',
                onlyForCaller: 'Sadece Ceza Söyleyen İçin',
                calculateRound: 'Eli Kaydet ve Sonrakine Geç',
                fillAllRequiredFields: 'Tüm Alanları Doldurun',
                
                // Game Over
                gameOver: 'OYUN BİTTİ!',
                allPenaltiesPlayed: 'Tüm cezalar oynandı. Kazanan:',
                
                // Buttons
                gameHistory: 'Geçmiş Oyunlar',
                readRules: 'Kuralları Oku',
                playerSettings: 'Oyuncu Ayarları',
                newGame: 'Yeni Oyun Başlat',
                
                // Stakes
                coffee: 'Kahve ısmarlama',
                food: 'Yemek ısmarlama',
                icecream: 'Dondurma ısmarlama',
                fun: 'Sadece eğlence',
                money: 'Para',
                custom: 'Özel',
                
                // Penalties (Turkish names)
                penalties: {
                    "3S": "3'lü Seri",
                    "3K": "3'lü Küt", 
                    "3S3K": "3'lü Seri + 3'lü Küt",
                    "23S": "2 3'lü Seri",
                    "23K": "2 3'lü Küt",
                    "4S": "4'lü Seri",
                    "4K": "4'lü Küt",
                    "4S4K": "4 Seri 4 Küt",
                    "24S": "2 4'lü Seri",
                    "24K": "2 4'lü Küt",
                    "5S": "5'li Seri",
                    "Ç": "Çift",
                    "E": "Elden"
                },
                
                // Modal titles
                gameHistoryModalTitle: '📊 Geçmiş Oyunlar',
                gameDetailModalTitle: '🎮 Oyun Detayları',
                
                // Table headers
                round: 'El',
                penalty: 'Ceza',
                caller: 'Söyleyen',
                winner: 'Bitiren',
                
                // Messages
                noGameHistory: 'Henüz oyun geçmişi yok',
                completeFirstGame: 'İlk oyununuzu tamamlayın ve burada görün',
                remainingPenalties: 'Kalan Cezalar',
                scoreTable: 'Kümülatif Puan Tablosu',
                
                // Status messages
                bonusPoints: '+50 bonus puan (Söyledi ve Bitirdi)',
                noLastRoundBonus: 'Son elde bonus yok (Elden kuralı)',
                jokerEffect: '🃏 Joker etkisi: Herkese x2 ceza puanı',
                uselessCardPenalty: '-50 ceza puanı (İşler kağıt)',
                failedCallerPenalty: 'x2 ceza puanı (Görevini açamadı)',
                
                // Player labels
                player: 'Oyuncu',
                points: 'puan',
                
                // Warning messages
                callerFailedWarning: 'Cezayı Söyleyen Görevini Açamadı!',
                callerFailedDesc: 'cezayı söyledi ama görevini açamadı - x2 ceza puanı alacak',
                lastRoundRule: 'Son El (Elden) Kuralı',
                lastRoundRuleDesc: 'Bu elde cezayı söyleyip bitiren oyuncu +50 bonus alamaz',
                jokerEffectActive: 'Joker Etkisi Aktif!',
                jokerEffectDesc: 'joker ile bitirdi - Tüm ceza puanları x2 olacak',
                missingFields: 'Eksik alanlar:',
                selectPlayedPenalty: '• Oynanan cezayı seçin',
                selectPenaltyCaller: '• Cezayı söyleyen oyuncuyu seçin',
                selectRoundWinner: '• Eli bitiren oyuncuyu seçin',
                enterOtherPenalties: '• Diğer oyuncuların ceza sayısını girin'
            },
            en: {
                // Setup Screen
                gameSetupTitle: '🃏 Americano Game Setup',
                gameSetupSubtitle: 'Set player count and names',
                playerCount: 'Player Count',
                playerCountDesc: '3-5 players',
                playerNames: 'Player Names',
                gameStakeTitle: 'What is this game for?',
                gameStakePlaceholder: 'Example: Coffee treat, Dinner treat...',
                startGame: '🎯 Start Game',
                fillAllFields: 'Please fill in all player names',
                thisGame: 'This game',
                gameRules: 'Game Rules:',
                
                // Game Screen
                round: 'Round',
                penaltiesLeft: 'penalties left',
                leader: 'Leader',
                totalScore: 'total score',
                scoreInput: 'Score Input',
                penaltyPlayed: 'Penalty Played This Round:',
                selectPenalty: 'Select penalty...',
                penaltyCaller: 'Player Who Called Penalty:',
                selectPlayer: 'Select player...',
                thisRoundPenalty: 'Penalty Count This Round',
                finishedRound: 'Finished Round',
                finishedWithJoker: 'Finished With Joker',
                threwUselessCard: 'Threw Useless Card',
                failedToComplete: 'Failed to Complete',
                onlyForCaller: 'Only for Penalty Caller',
                calculateRound: 'Save Round and Continue',
                fillAllRequiredFields: 'Fill All Required Fields',
                
                // Game Over
                gameOver: 'GAME OVER!',
                allPenaltiesPlayed: 'All penalties played. Winner:',
                
                // Buttons
                gameHistory: 'Game History',
                readRules: 'Read Rules',
                playerSettings: 'Player Settings',
                newGame: 'Start New Game',
                
                // Stakes
                coffee: 'Coffee treat',
                food: 'Food treat',
                icecream: 'Ice cream treat',
                fun: 'Just for fun',
                money: 'Money',
                custom: 'Custom',
                
                // Penalties (English names)
                penalties: {
                    "3S": "3-Card Sequence",
                    "3K": "3-Card Set",
                    "3S3K": "3-Card Sequence + 3-Card Set",
                    "23S": "2 3-Card Sequences",
                    "23K": "2 3-Card Sets",
                    "4S": "4-Card Sequence",
                    "4K": "4-Card Set",
                    "4S4K": "4-Card Sequence + 4-Card Set",
                    "24S": "2 4-Card Sequences",
                    "24K": "2 4-Card Sets",
                    "5S": "5-Card Sequence",
                    "Ç": "Pair",
                    "E": "Going Out"
                },
                
                // Modal titles
                gameHistoryModalTitle: '📊 Game History',
                gameDetailModalTitle: '🎮 Game Details',
                
                // Table headers
                round: 'Round',
                penalty: 'Penalty',
                caller: 'Caller',
                winner: 'Winner',
                
                // Messages
                noGameHistory: 'No game history yet',
                completeFirstGame: 'Complete your first game to see it here',
                remainingPenalties: 'Remaining Penalties',
                scoreTable: 'Cumulative Score Table',
                
                // Status messages
                bonusPoints: '+50 bonus points (Called and Finished)',
                noLastRoundBonus: 'No bonus in last round (Going Out rule)',
                jokerEffect: '🃏 Joker effect: x2 penalty points for everyone',
                uselessCardPenalty: '-50 penalty points (Useless card)',
                failedCallerPenalty: 'x2 penalty points (Failed to complete)',
                
                // Player labels
                player: 'Player',
                points: 'points',
                
                // Warning messages
                callerFailedWarning: 'Penalty Caller Failed to Complete!',
                callerFailedDesc: 'called the penalty but failed to complete - will get x2 penalty points',
                lastRoundRule: 'Last Round (Going Out) Rule',
                lastRoundRuleDesc: 'Player who calls and finishes this round cannot get +50 bonus',
                jokerEffectActive: 'Joker Effect Active!',
                jokerEffectDesc: 'finished with joker - All penalty points will be x2',
                missingFields: 'Missing fields:',
                selectPlayedPenalty: '• Select the played penalty',
                selectPenaltyCaller: '• Select the penalty caller',
                selectRoundWinner: '• Select the round winner',
                enterOtherPenalties: '• Enter other players\' penalty counts'
            }
        };

        // Game state variables
        let gameState = {
            language: 'tr', // Default language
            gameStarted: false,
            playerCount: 3,
            players: ['', '', ''], // Boş stringler ile başlat
            darkMode: false,
            gameStake: '',
            currentRound: 1,
            selectedPenalty: '',
            penaltyCaller: '',
            roundPenalties: {},
            roundWinner: '',
            işlerKağıtAtan: '',
            jokerIleBitiren: '',
            cezayıSöyleyenAçamadı: '',
            gameHistory: [],
            playedPenalties: {},
            customPenalties: [],
            gameStartDate: null
        };

        let defaultPenalties = [
            { id: 1, name: "3S", short: "3S", symbol: "①", isCustom: false },
            { id: 2, name: "3K", short: "3K", symbol: "②", isCustom: false },
            { id: 3, name: "3S3K", short: "3S3K", symbol: "③", isCustom: false },
            { id: 4, name: "23S", short: "23S", symbol: "④", isCustom: false },
            { id: 5, name: "23K", short: "23K", symbol: "⑤", isCustom: false },
            { id: 6, name: "4S", short: "4S", symbol: "⑥", isCustom: false },
            { id: 7, name: "4K", short: "4K", symbol: "⑦", isCustom: false },
            { id: 8, name: "4S4K", short: "4S4K", symbol: "⑧", isCustom: false },
            { id: 9, name: "24S", short: "24S", symbol: "⑨", isCustom: false },
            { id: 10, name: "24K", short: "24K", symbol: "⑩", isCustom: false },
            { id: 11, name: "5S", short: "5S", symbol: "⑪", isCustom: false },
            { id: 12, name: "Ç", short: "Ç", symbol: "⑫", isCustom: false },
            { id: 13, name: "E", short: "E", symbol: "⑬", isCustom: false }
        ];

        // Translation helper function
        function t(key, fallback = key) {
            const keys = key.split('.');
            let value = translations[gameState.language];
            
            for (const k of keys) {
                if (value && value[k] !== undefined) {
                    value = value[k];
                } else {
                    return fallback || key;
                }
            }
            
            return value || fallback || key;
        }

        // Language toggle function
        function toggleLanguage() {
            gameState.language = gameState.language === 'tr' ? 'en' : 'tr';
            updateLanguageToggle();
            updateAllTexts();
            
            // Save language preference
            try {
                localStorage.setItem('americano_language', gameState.language);
            } catch (error) {
                console.error('Error saving language preference:', error);
            }
        }

        function updateLanguageToggle() {
            // Update both toggles (setup and game)
            const toggles = ['languageToggle', 'languageToggleGame'];
            const trElements = ['langTr', 'langTrGame'];
            const enElements = ['langEn', 'langEnGame'];
            
            toggles.forEach((toggleId, index) => {
                const toggle = document.getElementById(toggleId);
                const trElement = document.getElementById(trElements[index]);
                const enElement = document.getElementById(enElements[index]);
                
                if (toggle && trElement && enElement) {
                    if (gameState.language === 'tr') {
                        trElement.className = 'language-option active';
                        enElement.className = `language-option inactive ${gameState.darkMode ? 'dark' : ''}`;
                    } else {
                        trElement.className = `language-option inactive ${gameState.darkMode ? 'dark' : ''}`;
                        enElement.className = 'language-option active';
                    }
                    
                    // Update toggle background for dark mode
                    if (gameState.darkMode) {
                        toggle.classList.add('dark');
                    } else {
                        toggle.classList.remove('dark');
                    }
                }
            });
        }

        function updateAllTexts() {
            // Update setup screen texts
            document.getElementById('setupTitle').textContent = t('gameSetupTitle');
            document.getElementById('setupSubtitle').textContent = t('gameSetupSubtitle');
            document.getElementById('playerCountTitle').textContent = t('playerCount');
            document.getElementById('playerCountDesc').textContent = t('playerCountDesc');
            document.getElementById('playerNamesTitle').textContent = t('playerNames');
            document.getElementById('gameStakeTitle').textContent = t('gameStakeTitle');
            document.getElementById('gameStakeInput').placeholder = t('gameStakePlaceholder');
            document.getElementById('startGameBtn').innerHTML = t('startGame');
            document.getElementById('startGameError').textContent = t('fillAllFields');
            document.getElementById('thisGameLabel').textContent = t('thisGame');
            
            // Update stake buttons
            document.getElementById('coffeeBtn').innerHTML = `☕ ${t('coffee').split(' ')[0]}`;
            document.getElementById('foodBtn').innerHTML = `🍕 ${t('food').split(' ')[0]}`;
            document.getElementById('icecreamBtn').innerHTML = `🍦 ${t('icecream').split(' ')[0]}`;
            document.getElementById('funBtn').innerHTML = `🎉 ${t('fun').split(' ')[0] === 'Sadece' ? 'Eğlence' : 'Fun'}`;
            document.getElementById('moneyBtn').innerHTML = `💰 ${t('money')}`;
            document.getElementById('customBtn').innerHTML = `✏️ ${t('custom')}`;
            
            // Update game screen texts
            document.getElementById('roundLabel').textContent = t('round');
            document.getElementById('penaltiesLeftLabel').textContent = t('penaltiesLeft');
            document.getElementById('thisGameLabelGame').textContent = t('thisGame');
            document.getElementById('roundInputLabel').textContent = t('round');
            document.getElementById('scoreInputLabel').textContent = t('scoreInput');
            document.getElementById('penaltyPlayedLabel').textContent = t('penaltyPlayed');
            document.getElementById('selectPenaltyOption').textContent = t('selectPenalty');
            document.getElementById('penaltyCallerLabel').textContent = t('penaltyCaller');
            document.getElementById('selectPlayerOption').textContent = t('selectPlayer');
            document.getElementById('calculateBtnText').textContent = t('fillAllRequiredFields');
            
            // Update buttons
            document.getElementById('historyBtnText').textContent = t('gameHistory');
            document.getElementById('rulesBtnText').textContent = t('readRules');
            document.getElementById('settingsBtnText').textContent = t('playerSettings');
            document.getElementById('newGameBtnText').textContent = t('newGame');
            
            // Update modal titles
            document.getElementById('gameHistoryModalTitle').textContent = t('gameHistoryModalTitle');
            document.getElementById('gameDetailModalTitle').textContent = t('gameDetailModalTitle');
            
            // Update game over
            document.getElementById('gameOverTitle').innerHTML = `🎉 ${t('gameOver')} 🎉`;
            
            // Update other elements
            document.getElementById('scoreTableTitle').textContent = t('scoreTable');
            document.getElementById('remainingPenaltiesTitle').textContent = t('remainingPenalties');
            
            // Update game rules
            updateGameRules();
            
            // If game is started, update dynamic content while preserving values
            if (gameState.gameStarted) {
                updateGameScreen();
            }
            
            // Update player inputs
            updatePlayerInputs();
        }

        function updateGameRules() {
            const rulesList = document.getElementById('gameRulesList');
            const rules = gameState.language === 'tr' ? [
                '• <strong>3, 4 veya 5 oyuncuyla</strong> oynanır',
                '• <strong>13 farklı ceza</strong> türü vardır',
                '• <strong>"Elden" cezası</strong> mecburen son elde (13. el) oynanır',
                '• <strong>Cezayı söyleyen VE bitiren</strong> aynı kişiyse +50 puan',
                '• <strong>Cezayı söyleyen başarısız:</strong> Görevini yapamadan (açamadan) başkası bitirirse x2 ceza puanı alır',
                '• <strong>Son elde (Elden) bonus yok:</strong> Cezayı söyleyip bitiren +50 alamaz',
                '• <strong>İşler kağıt atan</strong> oyuncu -50 ceza puanı alır',
                '• <strong>Joker ile bitiren</strong> herkese x2 ceza puanı yedirir',
                '• <strong>Kazanma:</strong> En yüksek puan kazanır (eksi puanlarda en düşük eksi puan)'
            ] : [
                '• Played with <strong>3, 4 or 5 players</strong>',
                '• There are <strong>13 different penalty</strong> types',
                '• <strong>"Going Out" penalty</strong> must be played in the last round (13th round)',
                '• <strong>Penalty caller AND finisher</strong> gets +50 points if same person',
                '• <strong>Failed penalty caller:</strong> Gets x2 penalty points if someone else finishes before completing',
                '• <strong>No bonus in last round:</strong> Caller who finishes "Going Out" cannot get +50 bonus',
                '• <strong>Useless card thrower</strong> gets -50 penalty points',
                '• <strong>Joker finisher</strong> gives everyone x2 penalty points',
                '• <strong>Winning:</strong> Highest score wins (lowest negative score in case of negative points)'
            ];
            
            rulesList.innerHTML = rules.join('\n');
        }

        // Get all penalties (default + custom)
        function getAllPenalties() {
            return [...defaultPenalties, ...gameState.customPenalties].map(penalty => ({
                ...penalty,
                displayName: t(`penalties.${penalty.short}`, penalty.name)
            }));
        }

        // Initialize the app
        function initApp() {
            loadLanguagePreference();
            loadCustomPenalties();
            updatePlayerInputs();
            updatePlayerCount();
            updateStartButton();
            updateLanguageToggle();
            updateAllTexts();
            initEventListeners();
        }

        function loadLanguagePreference() {
            try {
                const saved = localStorage.getItem('americano_language');
                if (saved && (saved === 'tr' || saved === 'en')) {
                    gameState.language = saved;
                }
            } catch (error) {
                console.error('Error loading language preference:', error);
            }
        }

        function loadCustomPenalties() {
            try {
                const saved = localStorage.getItem('americano_custom_penalties');
                if (saved) {
                    gameState.customPenalties = JSON.parse(saved);
                }
            } catch (error) {
                console.error('Error loading custom penalties:', error);
                gameState.customPenalties = [];
            }
        }

        function saveCustomPenaltiesToStorage() {
            try {
                localStorage.setItem('americano_custom_penalties', JSON.stringify(gameState.customPenalties));
            } catch (error) {
                console.error('Error saving custom penalties:', error);
            }
        }

        function initEventListeners() {
            document.getElementById('addPlayerBtn').addEventListener('click', addPlayer);
            document.getElementById('removePlayerBtn').addEventListener('click', removePlayer);
            document.getElementById('startGameBtn').addEventListener('click', startGame);
            document.getElementById('gameStakeInput').addEventListener('input', updateGameStake);
        }

        function addPlayer() {
            if (gameState.playerCount < 5) {
                gameState.playerCount++;
                gameState.players.push(''); // Boş string ile başlat
                updatePlayerInputs();
                updatePlayerCount();
                updateStartButton();
            }
        }

        function removePlayer() {
            if (gameState.playerCount > 3) {
                gameState.playerCount--;
                gameState.players.pop();
                updatePlayerInputs();
                updatePlayerCount();
                updateStartButton();
            }
        }

        function updatePlayerCount() {
            document.getElementById('playerCountDisplay').textContent = gameState.playerCount;
            
            const removeBtn = document.getElementById('removePlayerBtn');
            const addBtn = document.getElementById('addPlayerBtn');
            
            if (gameState.playerCount <= 3) {
                removeBtn.className = 'p-3 rounded-lg font-bold transition-all bg-gray-300 text-gray-500 cursor-not-allowed';
            } else {
                removeBtn.className = 'p-3 rounded-lg font-bold transition-all bg-red-500 text-white hover:bg-red-600';
            }
            
            if (gameState.playerCount >= 5) {
                addBtn.className = 'p-3 rounded-lg font-bold transition-all bg-gray-300 text-gray-500 cursor-not-allowed';
            } else {
                addBtn.className = 'p-3 rounded-lg font-bold transition-all bg-green-500 text-white hover:bg-green-600';
            }
        }

        function updatePlayerInputs() {
            const container = document.getElementById('playerInputs');
            const gridClass = gameState.playerCount === 3 ? 'grid-cols-3' : 
                             gameState.playerCount === 4 ? 'grid-cols-2 md:grid-cols-4' : 
                             'grid-cols-2 md:grid-cols-3 lg:grid-cols-5';
            
            container.className = `grid gap-4 ${gridClass}`;
            container.innerHTML = '';
            
            gameState.players.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'rounded-lg p-4 bg-white';
                playerDiv.innerHTML = `
                    <label class="block text-sm font-medium mb-2 text-gray-700">${t('player')} ${index + 1}</label>
                    <input type="text" value="${player}" onchange="updatePlayerName(${index}, this.value)"
                           class="w-full p-3 border border-gray-300 rounded-lg text-center font-medium text-lg bg-white text-black placeholder-gray-400"
                           placeholder="${t('player')} ${index + 1}" />
                `;
                container.appendChild(playerDiv);
            });
        }

        function updatePlayerName(index, name) {
            gameState.players[index] = name;
            updateStartButton();
        }

        function updateStartButton() {
            const allFilled = gameState.players.every(player => player.trim() !== '');
            const startBtn = document.getElementById('startGameBtn');
            const errorDiv = document.getElementById('startGameError');
            
            if (allFilled) {
                startBtn.className = 'px-8 py-4 rounded-lg font-bold text-white text-xl transition-all bg-purple-600 hover:bg-purple-700 hover:scale-105';
                errorDiv.classList.add('hidden');
            } else {
                startBtn.className = 'px-8 py-4 rounded-lg font-bold text-white text-xl transition-all bg-gray-400 cursor-not-allowed';
                errorDiv.classList.remove('hidden');
            }
        }

        function setStake(stakeKey) {
            gameState.gameStake = t(stakeKey);
            document.getElementById('gameStakeInput').value = gameState.gameStake;
            updateGameStakeDisplay();
        }

        function setCustomStake() {
            const custom = prompt(gameState.language === 'tr' ? 'Özel iddia yazın:' : 'Enter custom stake:');
            if (custom) {
                gameState.gameStake = custom;
                document.getElementById('gameStakeInput').value = custom;
                updateGameStakeDisplay();
            }
        }

        function updateGameStake() {
            gameState.gameStake = document.getElementById('gameStakeInput').value;
            updateGameStakeDisplay();
        }

        function updateGameStakeDisplay() {
            const display = document.getElementById('gameStakeDisplay');
            const text = document.getElementById('gameStakeText');
            
            if (gameState.gameStake) {
                text.textContent = gameState.gameStake;
                display.classList.remove('hidden');
            } else {
                display.classList.add('hidden');
            }
        }

        function startGame() {
            startGameFromSetup();
        }

        function backToSetup() {
            document.getElementById('setupScreen').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
        }

        function startGameFromSetup() {
            const allFilled = gameState.players.every(player => player.trim() !== '');
            if (!allFilled) return;
            
            if (gameState.gameStarted) {
                document.getElementById('setupScreen').classList.add('hidden');
                document.getElementById('gameScreen').classList.remove('hidden');
                updateGameScreen();
                return;
            }
            
            gameState.gameStarted = true;
            gameState.gameStartDate = new Date().toLocaleString(gameState.language === 'tr' ? 'tr-TR' : 'en-US');
            gameState.roundPenalties = {};
            gameState.players.forEach(player => {
                gameState.roundPenalties[player] = '';
            });
            
            document.getElementById('setupScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            
            updateGameScreen();
        }

        function toggleDarkMode() {
            gameState.darkMode = !gameState.darkMode;
            const app = document.getElementById('app');
            const gameScreen = document.getElementById('gameScreen');
            const setupScreen = document.getElementById('setupScreen');
            const btn = document.getElementById('darkModeBtn');
            
            if (gameState.darkMode) {
                app.className = 'max-w-7xl mx-auto p-6 min-h-screen transition-colors bg-gray-900';
                if (gameScreen) gameScreen.className = gameScreen.className.replace('bg-white', 'bg-gray-800 text-white');
                if (setupScreen) {
                    const setupCard = setupScreen.querySelector('.bg-white');
                    if (setupCard) setupCard.className = setupCard.className.replace('bg-white', 'bg-gray-800 text-white');
                }
                btn.textContent = '☀️';
                btn.title = gameState.language === 'tr' ? 'Gündüz modu' : 'Light mode';
                btn.className = 'ml-2 p-2 rounded-lg transition-all bg-yellow-500 text-gray-900 hover:bg-yellow-400';
            } else {
                app.className = 'max-w-7xl mx-auto p-6 min-h-screen transition-colors bg-gradient-to-br from-purple-50 to-blue-100';
                if (gameScreen) gameScreen.className = gameScreen.className.replace('bg-gray-800 text-white', 'bg-white');
                if (setupScreen) {
                    const setupCard = setupScreen.querySelector('.bg-gray-800');
                    if (setupCard) setupCard.className = setupCard.className.replace('bg-gray-800 text-white', 'bg-white');
                }
                btn.textContent = '🌙';
                btn.title = gameState.language === 'tr' ? 'Gece modu' : 'Dark mode';
                btn.className = 'ml-2 p-2 rounded-lg transition-all bg-gray-200 text-gray-700 hover:bg-gray-300';
            }
            
            updateLanguageToggle();
        }

        function updateGameScreen() {
            document.getElementById('playersDisplay').textContent = gameState.players.join(' - ');
            document.getElementById('currentRoundDisplay').textContent = gameState.currentRound;
            document.getElementById('roundInputTitle').textContent = gameState.currentRound;
            
            updateRemainingPenalties();
            updateScoreCards();
            
            // Seçili değerleri koru
            const selectedPenaltyValue = gameState.selectedPenalty;
            const selectedCallerValue = gameState.penaltyCaller;
            
            updatePenaltySelector();
            updatePlayerSelector();
            
            // Değerleri geri yükle
            if (selectedPenaltyValue) {
                const penaltySelect = document.getElementById('selectedPenalty');
                penaltySelect.value = selectedPenaltyValue;
                gameState.selectedPenalty = selectedPenaltyValue;
            }
            
            if (selectedCallerValue) {
                const callerSelect = document.getElementById('penaltyCaller');
                callerSelect.value = selectedCallerValue;
                gameState.penaltyCaller = selectedCallerValue;
            }
            
            updatePlayerInputCards();
            updateGameStakeGameDisplay();
        }

        function updateGameStakeGameDisplay() {
            const display = document.getElementById('gameStakeGameDisplay');
            const text = document.getElementById('gameStakeGameText');
            
            if (gameState.gameStake) {
                text.textContent = gameState.gameStake;
                display.classList.remove('hidden');
            } else {
                display.classList.add('hidden');
            }
        }

        function getRemainingPenalties() {
            return getAllPenalties().filter(p => !gameState.playedPenalties[p.id]);
        }

        function getAvailablePenalties() {
            const available = getRemainingPenalties();
            if (available.length > 1 && available.some(p => p.id === 13)) {
                return available.filter(penalty => penalty.id !== 13);
            }
            return available;
        }

        function getCurrentScores() {
            const scores = {};
            gameState.players.forEach(player => {
                scores[player] = 0;
            });
            
            gameState.gameHistory.forEach(round => {
                round.results.forEach(result => {
                    scores[result.player] += result.totalChange;
                });
            });
            
            return scores;
        }

        function getLeader() {
            const scores = getCurrentScores();
            const maxScore = Math.max(...Object.values(scores));
            if (maxScore <= 0) return null;
            return Object.keys(scores).find(player => scores[player] === maxScore);
        }

        function updateScoreCards() {
            const scores = getCurrentScores();
            const leader = getLeader();
            const container = document.getElementById('scoreCards');
            const gridClass = 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3';
            
            container.className = `grid gap-4 mb-8 ${gridClass}`;
            container.innerHTML = '';
            
            gameState.players.forEach(player => {
                const score = scores[player] || 0;
                const scoreClass = score >= 0 ? 'text-green-600 bg-green-50' : 'text-red-600 bg-red-50';
                
                const div = document.createElement('div');
                div.className = 'rounded-xl p-6 border text-center bg-gradient-to-br from-gray-50 to-gray-100 border-gray-200 w-full';
                div.innerHTML = `
                    <h3 class="font-bold text-lg mb-2 text-gray-800">${player}</h3>
                    <div class="text-3xl font-bold rounded-lg py-3 px-4 shadow-inner ${scoreClass}">
                        ${score > 0 ? '+' : ''}${score}
                    </div>
                    <div class="text-sm mt-1 text-gray-500">${t('totalScore')}</div>
                `;
                container.appendChild(div);
            });
            
            const leaderBanner = document.getElementById('leaderBanner');
            const leaderText = document.getElementById('leaderText');
            
            if (leader) {
                leaderText.textContent = `${t('leader')}: ${leader} (${scores[leader]} ${t('points')})`;
                leaderBanner.classList.remove('hidden');
            } else {
                leaderBanner.classList.add('hidden');
            }
        }

        function updatePenaltySelector() {
            const select = document.getElementById('selectedPenalty');
            const remaining = getRemainingPenalties();
            const available = getAvailablePenalties();
            
            select.innerHTML = `<option value="">${t('selectPenalty')}</option>`;
            
            if (remaining.length === 1 && remaining[0].id === 13) {
                select.innerHTML = '';
                const option = document.createElement('option');
                option.value = '13';
                option.textContent = `⑬ ${t('penalties.E')} (${gameState.language === 'tr' ? 'Son El - Mecburi' : 'Last Round - Mandatory'})`;
                option.selected = true;
                select.appendChild(option);
                select.style.backgroundColor = '#fef2f2';
                select.style.color = '#b91c1c';
                gameState.selectedPenalty = '13';
            } else {
                available.forEach(penalty => {
                    const option = document.createElement('option');
                    option.value = penalty.id;
                    option.textContent = `${penalty.symbol} ${penalty.displayName} (${penalty.short})`;
                    select.appendChild(option);
                });
                select.style.backgroundColor = '';
                select.style.color = '';
            }
            
            select.style.fontSize = '18px';
            select.style.padding = '16px';
            
            // Event listener'ı yeniden ekle
            select.removeEventListener('change', handlePenaltyChange);
            select.addEventListener('change', handlePenaltyChange);
        }

        function handlePenaltyChange(event) {
            gameState.selectedPenalty = event.target.value;
            updateCalculateButton();
        }

        function updatePlayerSelector() {
            const select = document.getElementById('penaltyCaller');
            select.className = 'w-full p-4 md:p-3 text-lg md:text-lg min-h-[60px] md:min-h-[50px] border border-gray-300 rounded-lg font-medium';
            select.style.fontSize = '18px';
            select.style.padding = '16px';
            select.innerHTML = `<option value="">${t('selectPlayer')}</option>`;
            
            gameState.players.forEach(player => {
                const option = document.createElement('option');
                option.value = player;
                option.textContent = player;
                select.appendChild(option);
            });
            
            // Event listener'ı yeniden ekle
            select.removeEventListener('change', handlePlayerCallerChange);
            select.addEventListener('change', handlePlayerCallerChange);
        }

        function handlePlayerCallerChange(event) {
            gameState.penaltyCaller = event.target.value;
            updatePlayerInputCards();
            updateCalculateButton();
        }

        function updatePlayerInputCards() {
            const container = document.getElementById('playerInputCards');
            const gridClass = gameState.playerCount === 3 ? 'grid-cols-3' : 
                             gameState.playerCount === 4 ? 'grid-cols-2 md:grid-cols-4' : 
                             'grid-cols-2 md:grid-cols-3 lg:grid-cols-5';
            
            container.className = `grid gap-4 mb-6 ${gridClass}`;
            container.innerHTML = '';
            
            gameState.players.forEach(player => {
                const div = document.createElement('div');
                div.className = 'bg-white rounded-lg p-4';
                
                const isWinner = gameState.roundWinner === player;
                const penaltyInput = isWinner ? 
                    `<div class="w-full p-4 border border-gray-200 rounded-xl text-center font-bold text-2xl bg-green-50 text-green-600 h-16 flex items-center justify-center">
                        0 (${t('finishedRound')})
                     </div>` :
                    `<input type="number" min="0" max="13" value="${gameState.roundPenalties[player] || ''}" 
                            onchange="updatePlayerPenalty('${player}', this.value)"
                            class="w-full p-4 border border-gray-300 rounded-xl text-center font-bold text-2xl h-16" placeholder="0" />
                     <div class="text-sm text-gray-500 mt-2 text-center font-medium">
                        <span id="penalty-preview-${player}">-${gameState.roundPenalties[player] || 0} ${t('points')}</span>
                     </div>`;
                
                div.innerHTML = `
                    <h4 class="font-semibold text-center mb-3">${player}</h4>
                    
                    <div class="mb-3">
                        <label class="block text-sm font-medium text-gray-700 mb-1">${t('thisRoundPenalty')}</label>
                        ${penaltyInput}
                    </div>
                    
                    <button onclick="toggleRoundWinner('${player}')" 
                            class="w-full py-2 px-3 rounded-lg font-medium transition-all mb-2 ${isWinner ? 'bg-green-500 text-white shadow-lg' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}">
                        ${isWinner ? `✓ ${t('finishedRound')}` : t('finishedRound')}
                    </button>
                    
                    <button onclick="toggleJokerWinner('${player}')" 
                            class="w-full py-2 px-3 rounded-lg font-medium transition-all mb-2 ${gameState.jokerIleBitiren === player ? 'bg-orange-500 text-white shadow-lg' : 'bg-orange-100 text-orange-700 hover:bg-orange-200'}">
                        ${gameState.jokerIleBitiren === player ? `✓ ${t('finishedWithJoker')}` : t('finishedWithJoker')}
                    </button>
                    
                    <button onclick="toggleIslerKagit('${player}')" 
                            class="w-full py-2 px-3 rounded-lg font-medium transition-all mb-2 ${gameState.işlerKağıtAtan === player ? 'bg-red-500 text-white shadow-lg' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}">
                        ${gameState.işlerKağıtAtan === player ? `✓ ${t('threwUselessCard')}` : t('threwUselessCard')}
                    </button>
                    
                    <button onclick="toggleFailedCaller('${player}')" 
                            ${gameState.penaltyCaller !== player ? 'disabled' : ''}
                            class="w-full py-2 px-3 rounded-lg font-medium transition-all ${gameState.penaltyCaller !== player 
                                ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                : gameState.cezayıSöyleyenAçamadı === player
                                ? 'bg-purple-500 text-white shadow-lg'
                                : 'bg-purple-100 text-purple-700 hover:bg-purple-200'}">
                        ${gameState.penaltyCaller !== player 
                            ? t('onlyForCaller')
                            : gameState.cezayıSöyleyenAçamadı === player ? `✓ ${t('failedToComplete')}` : t('failedToComplete')
                        }
                    </button>
                    
                    <div id="status-${player}" class="text-center text-xs font-medium mt-1">
                        ${getPlayerStatus(player)}
                    </div>
                `;
                
                container.appendChild(div);
            });
            
            updatePenaltyPreviews();
        }

        function getPlayerStatus(player) {
            const isWinner = gameState.roundWinner === player;
            const isCaller = gameState.penaltyCaller === player;
            const isJoker = gameState.jokerIleBitiren === player;
            const isIsler = gameState.işlerKağıtAtan === player;
            const isFailed = gameState.cezayıSöyleyenAçamadı === player;
            
            let status = [];
            
            if (isWinner && isCaller && gameState.selectedPenalty !== '13') {
                status.push(`<div class="text-green-600">${t('bonusPoints')}</div>`);
            } else if (isWinner && isCaller && gameState.selectedPenalty === '13') {
                status.push(`<div class="text-gray-500">${t('noLastRoundBonus')}</div>`);
            }
            
            if (isJoker) {
                status.push(`<div class="text-orange-600">${t('jokerEffect')}</div>`);
            }
            
            if (isIsler) {
                status.push(`<div class="text-red-600">${t('uselessCardPenalty')}</div>`);
            }
            
            if (isFailed) {
                status.push(`<div class="text-purple-600">${t('failedCallerPenalty')}</div>`);
            }
            
            return status.join('');
        }

        function updatePlayerPenalty(player, value) {
            gameState.roundPenalties[player] = value;
            updatePenaltyPreviews();
            updateCalculateButton();
        }

        function updatePenaltyPreviews() {
            gameState.players.forEach(player => {
                const preview = document.getElementById(`penalty-preview-${player}`);
                if (preview) {
                    const baseValue = parseInt(gameState.roundPenalties[player]) || 0;
                    let multiplier = 1;
                    let effects = [];
                    
                    if (gameState.cezayıSöyleyenAçamadı === player && gameState.cezayıSöyleyenAçamadı !== '') {
                        multiplier *= 2;
                        effects.push(gameState.language === 'tr' ? 'x2 Görevini açamadı' : 'x2 Failed to complete');
                    }
                    
                    if (gameState.jokerIleBitiren && gameState.jokerIleBitiren !== '') {
                        multiplier *= 2;
                        effects.push(gameState.language === 'tr' ? 'x2 Joker etkisi' : 'x2 Joker effect');
                    }
                    
                    const finalValue = baseValue * multiplier;
                    
                    if (effects.length > 0) {
                        preview.innerHTML = `<span class="text-red-600 font-bold">-${finalValue} ${t('points')} (${effects.join(' + ')})</span>`;
                    } else {
                        preview.textContent = `-${baseValue} ${t('points')}`;
                    }
                }
            });
        }

        function toggleRoundWinner(player) {
            gameState.roundWinner = gameState.roundWinner === player ? '' : player;
            updatePlayerInputCards();
            updateCalculateButton();
        }

        function toggleJokerWinner(player) {
            gameState.jokerIleBitiren = gameState.jokerIleBitiren === player ? '' : player;
            if (gameState.jokerIleBitiren === player) {
                gameState.roundWinner = player;
            }
            updatePlayerInputCards();
            updateCalculateButton();
        }

        function toggleIslerKagit(player) {
            gameState.işlerKağıtAtan = gameState.işlerKağıtAtan === player ? '' : player;
            updatePlayerInputCards();
        }

        function toggleFailedCaller(player) {
            gameState.cezayıSöyleyenAçamadı = gameState.cezayıSöyleyenAçamadı === player ? '' : player;
            updatePlayerInputCards();
            updatePenaltyPreviews();
        }

        function canCalculate() {
            const allPenaltiesFilled = gameState.players.every(player => 
                player === gameState.roundWinner ? true : gameState.roundPenalties[player] !== undefined && gameState.roundPenalties[player] !== ''
            );
            return gameState.selectedPenalty !== '' && gameState.penaltyCaller !== '' && gameState.roundWinner !== '' && allPenaltiesFilled;
        }

        function updateCalculateButton() {
            const btn = document.getElementById('calculateBtn');
            const btnText = document.getElementById('calculateBtnText');
            const canCalc = canCalculate();
            
            if (canCalc) {
                btn.className = 'px-8 py-3 rounded-lg font-bold text-white transition-all bg-purple-600 hover:bg-purple-700 hover:scale-105';
                btnText.textContent = t('calculateRound');
            } else {
                btn.className = 'px-8 py-3 rounded-lg font-bold text-white transition-all bg-gray-400 cursor-not-allowed';
                btnText.textContent = t('fillAllRequiredFields');
            }
            
            updateWarningMessages();
        }

        function updateWarningMessages() {
            const container = document.getElementById('warningMessages');
            container.innerHTML = '';
            
            if (gameState.cezayıSöyleyenAçamadı) {
                const div = document.createElement('div');
                div.className = 'mb-4 p-3 bg-purple-100 rounded-lg border border-purple-300';
                div.innerHTML = `
                    <p class="text-purple-800 font-medium">💜 ${t('callerFailedWarning')}</p>
                    <p class="text-sm text-purple-700 mt-1">${gameState.cezayıSöyleyenAçamadı} ${t('callerFailedDesc')}</p>
                `;
                container.appendChild(div);
            }
            
            if (gameState.selectedPenalty === '13') {
                const div = document.createElement('div');
                div.className = 'mb-4 p-3 bg-blue-100 rounded-lg border border-blue-300';
                div.innerHTML = `
                    <p class="text-blue-800 font-medium">⚠️ ${t('lastRoundRule')}</p>
                    <p class="text-sm text-blue-700 mt-1">${t('lastRoundRuleDesc')}</p>
                `;
                container.appendChild(div);
            }
            
            if (gameState.jokerIleBitiren) {
                const div = document.createElement('div');
                div.className = 'mb-4 p-3 bg-orange-100 rounded-lg border border-orange-300';
                div.innerHTML = `
                    <p class="text-orange-800 font-medium">🃏 ${t('jokerEffectActive')}</p>
                    <p class="text-sm text-orange-700 mt-1">${gameState.jokerIleBitiren} ${t('jokerEffectDesc')}</p>
                `;
                container.appendChild(div);
            }
            
            if (!canCalculate()) {
                const div = document.createElement('div');
                div.className = 'mb-4 p-3 bg-yellow-100 rounded-lg border border-yellow-300';
                const missing = [];
                
                if (!gameState.selectedPenalty) missing.push(t('selectPlayedPenalty'));
                if (!gameState.penaltyCaller) missing.push(t('selectPenaltyCaller'));
                if (!gameState.roundWinner) missing.push(t('selectRoundWinner'));
                
                const allPenaltiesFilled = gameState.players.every(player => 
                    player === gameState.roundWinner ? true : gameState.roundPenalties[player] !== undefined && gameState.roundPenalties[player] !== ''
                );
                if (!allPenaltiesFilled) missing.push(t('enterOtherPenalties'));
                
                div.innerHTML = `
                    <p class="text-yellow-800 font-medium">${t('missingFields')}</p>
                    <ul class="text-sm text-yellow-700 mt-2">
                        ${missing.map(item => `<li>${item}</li>`).join('')}
                    </ul>
                `;
                container.appendChild(div);
            }
        }

        function updateRemainingPenalties() {
            const remaining = getRemainingPenalties();
            document.getElementById('remainingPenaltiesDisplay').textContent = remaining.length;
            document.getElementById('remainingCount').textContent = remaining.length;
            
            const container = document.getElementById('remainingPenalties');
            container.innerHTML = '';
            
            const available = getAvailablePenalties();
            
            if (available.length > 0) {
                available.forEach(penalty => {
                    const div = document.createElement('div');
                    div.className = `bg-white p-3 rounded-lg border-2 transition-all ${penalty.isCustom ? 'border-purple-200 hover:border-purple-400' : 'border-yellow-200 hover:border-yellow-400'}`;
                    div.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="${penalty.isCustom ? 'bg-purple-100 text-purple-800' : 'bg-yellow-100 text-yellow-800'} font-bold rounded-full w-8 h-8 flex items-center justify-center text-sm">
                                ${penalty.symbol}
                            </span>
                            <div>
                                <div class="font-medium text-gray-800">${penalty.displayName} ${penalty.isCustom ? '⚡' : ''}</div>
                                <div class="text-xs text-gray-500">(${penalty.short})</div>
                            </div>
                        </div>
                    `;
                    container.appendChild(div);
                });
                
                if (!gameState.playedPenalties[13] && available.length > 0) {
                    const eldenDiv = document.createElement('div');
                    eldenDiv.className = 'bg-red-50 p-3 rounded-lg border-2 border-red-200';
                    eldenDiv.innerHTML = `
                        <div class="flex items-center gap-3">
                            <span class="bg-red-100 text-red-800 font-bold rounded-full w-8 h-8 flex items-center justify-center text-sm">⑬</span>
                            <div>
                                <div class="font-medium text-red-700">${t('penalties.E')}</div>
                                <div class="text-xs text-red-500">(E) - ${gameState.language === 'tr' ? 'Son elde mecburi' : 'Mandatory in last round'}</div>
                            </div>
                        </div>
                    `;
                    container.appendChild(eldenDiv);
                }
            } else {
                const message = document.createElement('div');
                message.className = 'text-center text-gray-500 py-4';
                const messageText = remaining.length === 1 ? 
                    (gameState.language === 'tr' ? 'Son el - Sadece "Elden" kaldı! 🎯' : 'Last round - Only "Going Out" left! 🎯') :
                    (gameState.language === 'tr' ? 'Tüm cezalar oynandı! 🎉' : 'All penalties played! 🎉');
                message.innerHTML = `<p class="text-lg">${messageText}</p>`;
                container.appendChild(message);
            }
        }

        function calculateRoundScore() {
            if (!canCalculate()) return;
            
            const scores = getCurrentScores();
            const roundResults = [];
            const allPenalties = getAllPenalties();
            const penalty = allPenalties.find(p => p.id === parseInt(gameState.selectedPenalty));

            gameState.players.forEach(player => {
                let originalPenalty = parseInt(gameState.roundPenalties[player]) || 0;
                let penaltyCount = originalPenalty;
                
                if (player === gameState.cezayıSöyleyenAçamadı && gameState.cezayıSöyleyenAçamadı !== '') {
                    penaltyCount = originalPenalty * 2;
                }
                
                if (gameState.jokerIleBitiren && gameState.jokerIleBitiren !== '') {
                    if (player === gameState.cezayıSöyleyenAçamadı && gameState.cezayıSöyleyenAçamadı !== '') {
                        penaltyCount = originalPenalty * 2 * 2;
                    } else {
                        penaltyCount = originalPenalty * 2;
                    }
                }
                
                if (player === gameState.roundWinner) {
                    penaltyCount = 0;
                    originalPenalty = 0;
                }
                
                let bonusPoints = 0;
                const isLastRound = gameState.selectedPenalty === '13';
                if (player === gameState.roundWinner && player === gameState.penaltyCaller && !isLastRound) {
                    bonusPoints = 50;
                }
                
                const işlerKağıtCezası = player === gameState.işlerKağıtAtan ? -50 : 0;
                const totalChange = -penaltyCount + bonusPoints + işlerKağıtCezası;
                
                roundResults.push({
                    player,
                    penalties: penaltyCount,
                    originalPenalties: originalPenalty,
                    bonus: bonusPoints,
                    işlerKağıtCezası: işlerKağıtCezası,
                    totalChange: totalChange,
                    newTotal: scores[player] + totalChange,
                    isWinner: player === gameState.roundWinner,
                    gotBonus: bonusPoints > 0,
                    attıİşlerKağıt: player === gameState.işlerKağıtAtan,
                    jokerEtkisi: gameState.jokerIleBitiren && gameState.jokerIleBitiren !== '',
                    cezayıSöyleyenAçamadı: player === gameState.cezayıSöyleyenAçamadı && gameState.cezayıSöyleyenAçamadı !== ''
                });
            });

            gameState.gameHistory.push({
                round: gameState.currentRound,
                penaltyId: penalty.id,
                penaltyName: penalty.displayName,
                penaltyShort: penalty.short,
                penaltySymbol: penalty.symbol,
                penaltyCaller: gameState.penaltyCaller,
                işlerKağıtAtan: gameState.işlerKağıtAtan,
                jokerIleBitiren: gameState.jokerIleBitiren,
                cezayıSöyleyenAçamadı: gameState.cezayıSöyleyenAçamadı,
                results: roundResults,
                winner: gameState.roundWinner,
                time: new Date().toLocaleTimeString(gameState.language === 'tr' ? 'tr-TR' : 'en-US')
            });

            gameState.playedPenalties[penalty.id] = true;

            // Reset for next round
            gameState.selectedPenalty = '';
            gameState.penaltyCaller = '';
            gameState.işlerKağıtAtan = '';
            gameState.jokerIleBitiren = '';
            gameState.cezayıSöyleyenAçamadı = '';
            
            gameState.roundPenalties = {};
            gameState.players.forEach(player => {
                gameState.roundPenalties[player] = '';
            });
            gameState.roundWinner = '';
            gameState.currentRound++;
            
            // Selector'ları sıfırla
            const penaltySelect = document.getElementById('selectedPenalty');
            const callerSelect = document.getElementById('penaltyCaller');
            if (penaltySelect) penaltySelect.value = '';
            if (callerSelect) callerSelect.value = '';
            
            updateGameScreen();
            updateGameHistory();
            checkGameOver();
        }

        function updateGameHistory() {
            if (gameState.gameHistory.length === 0) return;
            
            const section = document.getElementById('gameHistorySection');
            section.classList.remove('hidden');
            
            const thead = document.getElementById('gameHistoryTableHead');
            const tbody = document.getElementById('gameHistoryTableBody');
            
            thead.innerHTML = `
                <tr class="bg-purple-600 text-white">
                    <th class="border p-3 font-bold">${t('round')}</th>
                    <th class="border p-3 font-bold">${t('penalty')} / ${t('caller')}</th>
                    ${gameState.players.map(player => `<th class="border p-3 font-bold">${player}</th>`).join('')}
                </tr>
            `;
            
            tbody.innerHTML = '';
            gameState.gameHistory.forEach((round, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 0 ? 'bg-gray-50' : 'bg-white';
                
                tr.innerHTML = `
                    <td class="border p-3 text-center">
                        <div class="font-bold text-lg text-purple-600">${round.round}</div>
                        <div class="text-xs text-gray-500">${t('round')}</div>
                    </td>
                    <td class="border p-3 font-medium text-center">
                        <div class="font-bold">${round.penaltySymbol}</div>
                        <div class="text-xs text-gray-600">${round.penaltyName}</div>
                        <div class="text-xs text-blue-600 font-medium mt-1">👤 ${round.penaltyCaller}</div>
                        ${round.işlerKağıtAtan ? `<div class="text-xs text-red-600 font-medium">⚠️ ${round.işlerKağıtAtan}</div>` : ''}
                        ${round.jokerIleBitiren ? `<div class="text-xs text-orange-600 font-medium">🃏 ${round.jokerIleBitiren}</div>` : ''}
                        ${round.cezayıSöyleyenAçamadı ? `<div class="text-xs text-purple-600 font-medium">💜 ${round.cezayıSöyleyenAçamadı}</div>` : ''}
                    </td>
                    ${gameState.players.map(player => {
                        const result = round.results.find(r => r.player === player);
                        return `
                            <td class="border p-3 text-center">
                                <div class="font-bold text-lg ${result?.newTotal >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${result?.newTotal || 0}
                                </div>
                                <div class="text-xs text-gray-500">
                                    (${result?.totalChange > 0 ? '+' : ''}${result?.totalChange || 0})
                                    ${result?.gotBonus ? '🏆' : ''}
                                    ${result?.isWinner && !result?.gotBonus ? '🏁' : ''}
                                    ${result?.attıİşlerKağıt ? '⚠️' : ''}
                                    ${result?.jokerEtkisi ? '🃏' : ''}
                                    ${result?.cezayıSöyleyenAçamadı ? '💜' : ''}
                                </div>
                            </td>
                        `;
                    }).join('')}
                `;
                
                tbody.appendChild(tr);
            });
        }

        function checkGameOver() {
            const remaining = getRemainingPenalties();
            if (remaining.length === 0) {
                const leader = getLeader();
                const scores = getCurrentScores();
                
                saveGameToHistory();
                
                document.getElementById('roundInputSection').classList.add('hidden');
                document.getElementById('gameOverSection').classList.remove('hidden');
                document.getElementById('gameOverText').textContent = `${t('allPenaltiesPlayed')} ${leader} (${scores[leader]} ${t('points')})`;
            }
        }

        function saveGameToHistory() {
            const finalScores = getCurrentScores();
            const winner = getLeader();
            
            const gameRecord = {
                id: Date.now(),
                date: new Date().toLocaleString(gameState.language === 'tr' ? 'tr-TR' : 'en-US'),
                startDate: gameState.gameStartDate || new Date().toLocaleString(gameState.language === 'tr' ? 'tr-TR' : 'en-US'),
                players: [...gameState.players],
                gameStake: gameState.gameStake,
                totalRounds: gameState.currentRound - 1,
                finalScores: finalScores,
                winner: winner,
                gameHistory: [...gameState.gameHistory],
                customPenaltiesUsed: gameState.customPenalties.filter(cp => 
                    gameState.gameHistory.some(round => round.penaltyId === cp.id)
                ),
                language: gameState.language
            };

            try {
                const savedGames = JSON.parse(localStorage.getItem('americano_game_history') || '[]');
                savedGames.unshift(gameRecord);
                
                if (savedGames.length > 50) {
                    savedGames.splice(50);
                }
                
                localStorage.setItem('americano_game_history', JSON.stringify(savedGames));
            } catch (error) {
                console.error('Error saving game to history:', error);
            }
        }

        function showGameHistory() {
            try {
                const savedGames = JSON.parse(localStorage.getItem('americano_game_history') || '[]');
                const container = document.getElementById('gameHistoryList');
                
                if (savedGames.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <p class="text-lg">${t('noGameHistory')}</p>
                            <p class="text-sm mt-2">${t('completeFirstGame')}</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = '';
                    savedGames.forEach((game, index) => {
                        const gameDiv = document.createElement('div');
                        gameDiv.className = 'bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-lg border hover:shadow-md transition-all cursor-pointer mb-4';
                        gameDiv.onclick = () => showGameDetail(game);
                        
                        const playersText = game.players.join(', ');
                        const scoresText = game.players.map(p => `${p}: ${game.finalScores[p]}`).join(' | ');
                        
                        gameDiv.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">
                                            ${gameState.language === 'tr' ? 'Oyun' : 'Game'} #${savedGames.length - index}
                                        </span>
                                        <span class="text-gray-500 text-sm">${game.date}</span>
                                    </div>
                                    <h3 class="font-bold text-lg text-gray-800 mb-1">
                                        🏆 ${gameState.language === 'tr' ? 'Kazanan' : 'Winner'}: ${game.winner} (${game.finalScores[game.winner]} ${t('points')})
                                    </h3>
                                    <p class="text-sm text-gray-600 mb-2">
                                        <strong>${gameState.language === 'tr' ? 'Oyuncular' : 'Players'}:</strong> ${playersText}
                                    </p>
                                    <p class="text-sm text-gray-600 mb-2">
                                        <strong>${gameState.language === 'tr' ? 'Oyun' : 'Game'}:</strong> ${game.gameStake || (gameState.language === 'tr' ? 'Belirtilmemiş' : 'Not specified')} | 
                                        <strong>${gameState.language === 'tr' ? 'El Sayısı' : 'Round Count'}:</strong> ${game.totalRounds}
                                    </p>
                                    <p class="text-xs text-gray-500">
                                        ${scoresText}
                                    </p>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl">🎮</div>
                                    <div class="text-xs text-gray-500 mt-1">${gameState.language === 'tr' ? 'Detaylar için tıkla' : 'Click for details'}</div>
                                </div>
                            </div>
                        `;
                        container.appendChild(gameDiv);
                    });
                }
                
                document.getElementById('gameHistoryModal').classList.remove('hidden');
            } catch (error) {
                console.error('Error loading game history:', error);
                alert(gameState.language === 'tr' ? 'Oyun geçmişi yüklenirken hata oluştu' : 'Error loading game history');
            }
        }

        function showGameDetail(game) {
            // Game detail implementation would be here
            // This is a simplified version
            alert(gameState.language === 'tr' ? 'Oyun detayları yakında eklenecek' : 'Game details coming soon');
        }

        function closeGameHistoryModal() {
            document.getElementById('gameHistoryModal').classList.add('hidden');
        }

        function closeGameDetailModal() {
            document.getElementById('gameDetailModal').classList.add('hidden');
        }

        function resetGame() {
            gameState.gameStarted = false;
            gameState.currentRound = 1;
            gameState.selectedPenalty = '';
            gameState.penaltyCaller = '';
            gameState.işlerKağıtAtan = '';
            gameState.jokerIleBitiren = '';
            gameState.cezayıSöyleyenAçamadı = '';
            
            gameState.roundPenalties = {};
            gameState.players.forEach(player => {
                gameState.roundPenalties[player] = '';
            });
            gameState.roundWinner = '';
            gameState.gameHistory = [];
            gameState.playedPenalties = {};
            
            document.getElementById('roundInputSection').classList.remove('hidden');
            document.getElementById('gameOverSection').classList.add('hidden');
            document.getElementById('gameHistorySection').classList.add('hidden');
            
            document.getElementById('setupScreen').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
        }

        function showRules() {
            alert(gameState.language === 'tr' ? 'Kurallar modal\'ı yakında eklenecek' : 'Rules modal coming soon');
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>

    <!-- Rules Modal (to be implemented) -->
    <div id="rulesModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="max-w-4xl w-full max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl bg-white">
            <div class="sticky top-0 p-6 border-b bg-white border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 id="rulesModalTitle" class="text-2xl font-bold text-gray-800">📖 Detaylı Americano Kuralları</h2>
                    <button onclick="closeRules()" class="p-2 rounded-lg transition-all bg-gray-100 hover:bg-gray-200 text-gray-700">
                        ✕
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="space-y-6 text-gray-700">
                    <!-- Rules content would be here -->
                    <p class="text-center text-gray-500">Rules content coming soon...</p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
